<!DOCTYPE html>
<html>
	<head>

		<!-- Basic -->
		<meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">	

		<title>EcoWash - Inicio</title>	

		<!-- Favicon -->
		<link rel="shortcut icon" href="img/ecofav.ico" type="image/x-icon" />
		<link rel="apple-touch-icon" href="img/apple-touch-icon.jpg">

		<!-- Mobile Metas -->
		<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<!-- Web Fonts  -->
		<link href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800%7CShadows+Into+Light" rel="stylesheet" type="text/css">

		<!-- Vendor CSS -->
		<link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.min.css">
		<link rel="stylesheet" href="vendor/font-awesome/css/font-awesome.min.css">
		<link rel="stylesheet" href="vendor/simple-line-icons/css/simple-line-icons.min.css">
		<link rel="stylesheet" href="vendor/owl.carousel/assets/owl.carousel.min.css">
		<link rel="stylesheet" href="vendor/owl.carousel/assets/owl.theme.default.min.css">
		<link rel="stylesheet" href="vendor/magnific-popup/magnific-popup.min.css">

		<!-- Theme CSS -->
		<link rel="stylesheet" href="css/theme.css">
		<link rel="stylesheet" href="css/theme-elements.css">
		<link rel="stylesheet" href="css/theme-blog.css">
		<link rel="stylesheet" href="css/theme-shop.css">
		<link rel="stylesheet" href="css/theme-animate.css">
		<link rel="stylesheet" href="css/app.css">

		<!-- Skin CSS -->
		<link rel="stylesheet" href="css/skins/default.css">

		<!-- Head Libs -->
		<script src="vendor/modernizr/modernizr.min.js"></script>

	</head>
	<body>
		<div class="body">
			<div role="main" class="main" id="app-container" style="padding-bottom:150px; padding-top:20px">
				<div class="container">
					<div class="row">
						<div class="col-md-12">
							<div class="featured-boxes">
								<div class="row">
									<div class="col-sm-6">
										<div class="featured-box featured-box-primary align-left mt-xlg">
											<div class="box-content">
												<h4 class="heading-primary text-uppercase mb-md">Iniciar sesión</h4>
												<form action="/" id="login-form" method="post">
													<div class="row">
														<div class="form-group">
															<div class="col-md-12">
																<label>Nombre de usuario o correo</label>
																<input type="text" value="" class="form-control input-lg" name="Email">
															</div>
														</div>
													</div>
													<div class="row">
														<div class="form-group">
															<div class="col-md-12">
																<label>Contraseña</label>
																<input type="password" value="" class="form-control input-lg" name="Password">
															</div>
														</div>
													</div>
													<div class="row">
														<div class="col-md-12">
															<input type="submit" value="Login" class="btn btn-primary pull-right mb-xl" data-loading-text="Cargando...">
														</div>
													</div>
												</form>
											</div>
										</div>
									</div>
									<div class="col-sm-6">
										<div class="featured-box featured-box-primary align-left mt-xlg">
											<div class="box-content">
												<h4 class="heading-primary text-uppercase mb-md">Registrate</h4>
												<form id="signup-form">
													<div class="row">
														<div class="form-group">
															<div class="col-md-12">
																<label>E-mail</label>
																<input type="email" value="" class="form-control input-lg" name="Email" required>
															</div>
														</div>
													</div>
													<div class="row">
														<div class="form-group">
															<div class="col-md-12">
																<label>Nombre</label>
																<input type="text" value="" class="form-control input-lg" name="Name" required>
															</div>
														</div>
													</div>
													<div class="row">
														<div class="form-group">
															<div class="col-md-6">
																<label>Apellido paterno</label>
																<input type="text" value="" class="form-control input-lg" name="FirstLastName" required>
															</div>
															<div class="col-md-6">
																<label>Apellido materno</label>
																<input type="text" value="" class="form-control input-lg" name="SecondLastName" required>
															</div>
														</div>
													</div>
													<div class="row">
														<div class="form-group">
															<div class="col-md-6">
																<label>Password</label>
																<input type="password" value="" class="form-control input-lg" name="Password" required>
															</div>
															<div class="col-md-6">
																<label>Re-enter Password</label>
																<input type="password" value="" class="form-control input-lg" id="ConfirmPassword" required>
															</div>
														</div>
													</div>
													<div class="row">
														<div class="col-md-12">
															<input type="submit" value="Registrar" class="btn btn-primary pull-right mb-xl" data-loading-text="Loading...">
														</div>
													</div>
												</form>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Vendor -->
		<script src="vendor/jquery/jquery.min.js"></script>
		<script src="vendor/jquery.appear/jquery.appear.min.js"></script>
		<script src="vendor/jquery.easing/jquery.easing.min.js"></script>
		<script src="vendor/jquery-cookie/jquery-cookie.min.js"></script>
		<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
		<script src="vendor/common/common.min.js"></script>
		<script src="vendor/jquery.validation/jquery.validation.min.js"></script>
		<script src="vendor/jquery.stellar/jquery.stellar.min.js"></script>
		<script src="vendor/jquery.easy-pie-chart/jquery.easy-pie-chart.min.js"></script>
		<script src="vendor/jquery.gmap/jquery.gmap.min.js"></script>
		<script src="vendor/jquery.lazyload/jquery.lazyload.min.js"></script>
		<script src="vendor/isotope/jquery.isotope.min.js"></script>
		<script src="vendor/owl.carousel/owl.carousel.min.js"></script>
		<script src="vendor/magnific-popup/jquery.magnific-popup.min.js"></script>
		<script src="vendor/vide/vide.min.js"></script>
		
		<!-- Theme Base, Components and Settings -->
		<script src="js/theme.js"></script>
		
		<!-- Theme Custom -->
		<script src="js/custom.js"></script>
		
		<!-- Theme Initialization Files -->
		<script src="js/theme.init.js"></script>

		<script src="js/sammy.js"></script>
		<!-- <script src="js/app.js"></script> -->
		<script>
		(function(){

			var app = {
			    BaseUrl: 'http://192.168.0.10:1789/',
			}

			var token = localStorage['session-token']
		    if(token){
		    	window.location = 'http://localhost/ecowash/clientindex.html'
		    }

			$.fn.serializeObject = function () {
			    var o = {}
			    var a = this.serializeArray()
			    $.each(a, function () {
			        if (o[this.name] !== undefined) {
			            if (!o[this.name].push) {
			                o[this.name] = [o[this.name]]
			            }
			            o[this.name].push(this.value || '')
			        } else {
			            o[this.name] = this.value || ''
			        }
			    })
			    return o
			}

			function login(data){
				$.ajax({
			        url: app.BaseUrl + 'api/login',
			        type: 'POST',
			        contentType: 'application/json',
			        data: JSON.stringify(data),
			        statusCode: {
			            200: function (response) {
			            	console.log(response)
			            	localStorage['session-token'] = response.Token
			            	window.location = 'http://localhost/ecowash/clientindex.html'
			            },
			            400: function (response) {
			            },
			        }
			    })
			}

			 $(document.body).on('submit', '#login-form', function (event) {
			    event.preventDefault();
			    var data = $(this).serializeObject()
			    login(data)
			})

			 $(document.body).on('submit', '#signup-form', function (event) {
			    event.preventDefault();
			    console.log('will register')
			    var form = $(this).serializeObject()
			    var pass = form.Password
			    var confirmPass = $('#ConfirmPassword').val()
			    console.log(pass)
			    console.log(confirmPass)

			    if (pass !== confirmPass){
			    	alert('Las contraseñas deben ser diferentes.')
			    	return
			    }

			    $.ajax({
			        url: app.BaseUrl + 'api/register',
			        type: 'POST',
			        contentType: 'application/json',
			        data: JSON.stringify(form),
			        statusCode: {
			            200: function (response) {
			            	var data = {
			            		Email: data.Email,
			            		Password: data.Password
			            	}

			            	login(data)
			            },
			            400: function (response) {
			            },
			        }
			    })
			})
		})();
			
		</script>

	</body>
</html>
